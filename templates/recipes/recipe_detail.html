{% extends "base.html" %}
{% load recipe_tags i18n static %}

{% block title %}
    {{ block.super }}
    - {{ object.name }}
{% endblock %}


{% block main_content %}
    {{ block.super }}

    <div class="w-full mx-auto flex flex-col gap-10 items-center justify-start p-2 pb-10">
        <div class="w-full flex justify-between">
            <div class="flex flex-col gap-1">
                <h1>{{ recipe.name }}</h1>
                <c-a animated reverted visible_animation url="javascript:history.back();">Go back</c-a>
            </div>
            <c-a animated type="btn" url="{% url 'recipe-edit' recipe_id=object.pk %}" class="btn-neutral!">Edit
                Recipe
            </c-a>
        </div>

        <div class="grid grid-cols-2 gap-10 w-full mx-auto">
            <!-- Image Carousel -->
            <div class="carousel carousel-start w-full aspect-video rounded-sm">
                {% with images=recipe.images.all %}
                    {% for image in images %}
                        <div id="{{ image.image.name }}"
                             class="carousel-item relative w-full bg-cover bg-center bg-no-repeat rounded-sm"
                             style="background-image: url('{{ image.image.url }}');"
                        >
                        </div>
                    {% endfor %}
                    {% if not recipe.images.all %}
                        <div id="placeholder"
                             class="carousel-item relative w-full bg-cover bg-center bg-no-repeat rounded-sm"
                             style="background-image: url('{{ recipe.get_thumbnail_image }}');"
                        >
                        </div>
                    {% endif %}
                {% endwith %}
            </div>

            <!-- Recipe Details -->
            <div class="flex flex-col gap-5 justify-between">
                <div class="flex flex-col gap-5">
                    <p>
                        {% if recipe.description != "" %}
                            {{ recipe.description }}
                        {% else %}
                            {% translate 'No description for this recipe.' %}
                        {% endif %}
                    </p>
                </div>

                <div class="flex flex-col gap-5">
                    <!-- Skill Level -->
                    <div class="flex gap-5">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                             stroke="currentColor" class="size-6 text-secondary">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                  d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 0 1 3 19.875v-6.75ZM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V8.625ZM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V4.125Z"></path>
                        </svg>
                        <p>{{ recipe.skill_level }}</p>
                    </div>

                    <!-- Portions -->
                    <div class="flex gap-5">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                             stroke="currentColor" class="size-6 text-secondary">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                  d="M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z"></path>
                        </svg>
                        <p><span class="font-bold">{{ recipe.portions }}</span> Pers.</p>
                    </div>
                </div>

                <!-- Times -->
                <div class="flex gap-5">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                         stroke="currentColor" class="size-6 text-secondary">
                        <path stroke-linecap="round" stroke-linejoin="round"
                              d="M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"></path>
                    </svg>

                    <div class="w-full grid grid-cols-4 gap-5 px-4">
                        <!-- Total Time -->
                        <div class="flex flex-col gap-1 w-full">
                            <div class="flex gap-1 border-b-1 border-neutral pb-1">
                                <p>{% translate 'Total Time' %}</p>
                            </div>

                            <div class="flex justify-center gap-2 px-2">
                                <p><span class="text-secondary font-bold">{{ recipe.total_time_hours }}</span> h</p>
                                <p><span class="text-secondary font-bold">{{ recipe.total_time_minutes }}</span> min</p>
                            </div>
                        </div>

                        <!-- Cooking Time -->
                        <div class="flex flex-col gap-1 w-full">
                            <div class="flex gap-1 border-b-1 border-neutral pb-1">
                                <p>{% translate 'Cooking Time' %}</p>
                            </div>

                            <div class="flex justify-center gap-2 px-2">
                                <p><span class="font-bold">{{ recipe.cooking_time_hours }}</span> h</p>
                                <p><span class="font-bold">{{ recipe.cooking_time_minutes }}</span> min
                                </p>
                            </div>
                        </div>

                        <!-- Working Time -->
                        <div class="flex flex-col gap-1 w-full">
                            <div class="flex gap-1 border-b-1 border-neutral pb-1">
                                <p>{% translate 'Working Time' %}</p>
                            </div>

                            <div class="flex justify-center gap-2 px-2">
                                <p><span class="font-bold">{{ recipe.working_time_hours }}</span> h</p>
                                <p><span class="font-bold">{{ recipe.working_time_minutes }}</span> min
                                </p>
                            </div>
                        </div>

                        <!-- Rest Time -->
                        <div class="flex flex-col gap-1 w-full">
                            <div class="flex gap-1 border-b-1 border-neutral pb-1">
                                <p>{% translate 'Resting Time' %}</p>
                            </div>

                            <div class="flex justify-center gap-2 px-2">
                                <p><span class="font-bold">{{ recipe.rest_time_hours }}</span> h</p>
                                <p><span class="font-bold">{{ recipe.rest_time_minutes }}</span> min</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recipe Ingredients -->
            <div class="flex flex-col gap-5 justify-start w-full">
                <div class="flex justify-between items-center w-full">
                    <h2>{% translate 'Ingredients' %}</h2>
                    <div class="flex items-center justify-end gap-2 w-full">
                        <button
                                class="btn bg-secondary"
                                onclick="
                                        event.preventDefault();
                                        const input = document.getElementById('portions');
                                        const current = parseInt(input.value) || 0;
                                        if (current > 0) input.value = current - 1;
                                        this.setAttribute('hx-vals', JSON.stringify({portions: input.value}));
                                        "
                                hx-get="{% url 'calculate_scaled_ingredients' recipe_id=recipe.pk %}"
                                hx-target="#ingredients"
                                hx-swap="outerHTML"
                        >
                            -
                        </button>

                        <div class="flex flex-row-reverse gap-1 items-center w-fit">
                            <c-input id="portions" name="portions" value="{{ recipe.portions }}" disabled
                                     class="text-center max-w-12"
                                     labeled
                                     label="{% translate 'Pers.' %}"></c-input>
                        </div>

                        <button
                                class="btn bg-secondary"
                                onclick="
                                        event.preventDefault();
                                        const input = document.getElementById('portions');
                                        const current = parseInt(input.value) || 0;
                                        input.value = current + 1;
                                        this.setAttribute('hx-vals', JSON.stringify({portions: input.value}));
                                        "
                                hx-get="{% url 'calculate_scaled_ingredients' recipe_id=recipe.pk %}"
                                hx-target="#ingredients"
                                hx-swap="outerHTML">
                            +
                        </button>
                    </div>
                </div>

                {% include 'recipes/partials/recipe_ingredients_list.html' with ingredients=recipe.ingredients.all %}
            </div>

            <!-- Preparation Steps -->
            <div class="flex flex-col gap-5 justify-start">
                <h2>{% translate 'Preparation Steps' %}</h2>

                <ul class="flex flex-col gap-5">
                    {% for step in recipe.ordered_preparation_steps %}
                        <li class="flex flex-col gap-1">
                            <p class="w-fit relative">{% translate 'Preparation Step' %} <span
                                    class="font-extrabold">{{ step.order|add:"1" }}</span></p>
                            <p class="ps-5">{{ step.step_text }}</p>
                        </li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>
{% endblock %}