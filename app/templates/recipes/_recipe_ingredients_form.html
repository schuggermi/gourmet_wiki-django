{% load i18n %}

{% comment %}<ul class="mb-10">
  {% for ingredient in recipe.ingredients.all %}
    <li>{{ ingredient.name }} / {{ ingredient.quantity }} {{ ingredient.unit }}</li>
  {% empty %}
    <li>{% translate 'No ingredients yet.' %}</li>
  {% endfor %}
</ul>{% endcomment %}

<div class="mb-10">
  {% if recipe.ingredients.all %}
    <div class="overflow-x-auto bg-neutral/10 rounded-lg border border-neutral">
      <table class="table table-sm w-full">
        <thead class="bg-neutral text-neutral-content">
          <tr>
            <th class="font-semibold">{% translate 'Ingredient' %}</th>
            <th class="font-semibold text-right">{% translate 'Quantity' %}</th>
            <th class="font-semibold">{% translate 'Unit' %}</th>
            <th class="font-semibold text-right">{% translate 'Actions' %}</th>
          </tr>
        </thead>
        <tbody>
          {% for ingredient in recipe.ingredients.all %}
            <tr class="hover:bg-neutral/20 transition-colors">
                <td>{{ ingredient.name }}</td>
                <td class="text-right tabular-nums">{{ ingredient.quantity }}</td>
                <td>{{ ingredient.unit }}</td>
                <td class="flex justify-end gap-1">
                    <p class="cursor-pointer w-fit"
                       title="{% translate 'Edit this Ingredient' %}"
                       hx-get="{% url 'ingredient_edit' recipe.id ingredient.id %}"
                       hx-target="#recipe-ingredients-container"
                       hx-swap="innerHTML"
                    >
                        <c-edit-recipe-icon></c-edit-recipe-icon>
                    </p>
                    <p class="cursor-pointer w-fit"
                       title="{% translate 'Remove this Ingredient' %}"
                       hx-delete="{% url 'ingredient_delete' recipe.id ingredient.id %}"
                       hx-target="#recipe-ingredients-container"
                       hx-swap="innerHTML"
                       hx-confirm="{% translate 'Are you sure you want to remove this ingredient?' %}"
                    >
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                             stroke="currentColor"
                             class="size-6 text-error">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                  d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"></path>
                        </svg>
                    </p>
                </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <div class="alert bg-error/20 border border-neutral rounded-lg">
      <small class="text-[#2d5e3e]">{% translate 'No ingredients yet.' %}</small>
    </div>
  {% endif %}
</div>

<form id="recipe-ingredients-form"
      hx-post="{% url 'ingredient_add' recipe.id %}"
      hx-swap="innerHTML"
      hx-target="#recipe-ingredients-container"
      class="grid grid-cols-1 gap-2 w-full"
>
    {% csrf_token %}

    <div class="grid grid-cols-3 gap-2">
        <div class="col-span-3 md:col-span-1"><c-input :field="ingredient_form.name" labeled></c-input></div>
        <div class="col-span-2 md:col-span-1"><c-input :field="ingredient_form.quantity" type="number" labeled></c-input></div>
        <div><c-select :field="ingredient_form.unit" labeled></c-select></div>
    </div>

    <button class="self-end btn btn-primary" type="submit">
        {% translate '+ Add Ingredient' %}
    </button>
</form>
