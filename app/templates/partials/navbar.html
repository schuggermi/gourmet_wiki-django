{% load static i18n %}

<div id="navbar"
     class="h-10 navbar bg-base-100 shadow-xs sticky top-0 w-full transition-all duration-300 z-50 px-2">
    <div class="navbar-start flex items-center gap-3">
        <c-a url="{% url 'home' %}" title="Gourmet Wiki" class="flex items-end font-bold text-md md:text-xl">
            <img class="h-8 md:h-10 w-auto max-h-10 object-contain" src="{% static 'images/logo_icon_rotated.png' %}"
                 alt="Gourmet Wiki">
            <span class="text-base-content">Gourmet</span><span class="text-secondary">Wiki</span>
        </c-a>
    </div>
    <div class="w-max navbar-center hidden lg:flex flex-1 justify-center">
        <ul class="flex gap-5 px-1 w-max list-none">
            <li>
                <c-a url="{% url 'recipe-list' %}"
                     class="btn btn-md shadow-xs {% if request.resolver_match.url_name == 'recipe-list' %}btn-primary {% else %} btn-outline btn-neutral{% endif %}">
                    {% translate 'All Recipes' %}
                </c-a>
            </li>
            {% comment %}<li>
                <c-a url="{% url 'menu_list' %}"
                     class="btn btn-md {% if request.resolver_match.url_name == 'menu_list' %}btn-primary {% endif %}">
                    {% translate 'All Menus' %}
                </c-a>
            </li>{% endcomment %}
            <li>
                <c-a url="{% url 'wiki:article_list' %}"
                     class="btn btn-md shadow-xs {% if request.resolver_match.url_name == 'article_list' %}btn-primary {% else %} btn-outline btn-neutral{% endif %}">
                    {% translate 'Culinary Wiki' %}
                </c-a>
            </li>
        </ul>
    </div>
    <div class="navbar-end gap-2 md:gap-5">
        {# Language switcher: DE/EN dropdown posts to Django's set_language endpoint #}
        {% comment %}TODO <div class="dropdown dropdown-end">
            <div tabindex="0" role="button" class="btn btn-ghost gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="size-5" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                    <path d="M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2zm7.938 9h-3.223a15.91 15.91 0 0 0-1.1-4.336A8.03 8.03 0 0 1 19.938 11zM12 4c1.424 0 2.75 1.873 3.487 5H8.513C9.25 5.873 10.576 4 12 4zM7.385 6.664A15.91 15.91 0 0 0 6.285 11H3.062a8.03 8.03 0 0 1 4.323-4.336zM4.062 13h3.223c.226 1.501.62 2.948 1.1 4.336A8.03 8.03 0 0 1 4.062 13zM12 20c-1.424 0-2.75-1.873-3.487-5h6.974C14.75 18.127 13.424 20 12 20zm4.615-2.336A15.91 15.91 0 0 0 17.715 13h3.223a8.03 8.03 0 0 1-4.323 4.336z"/>
                </svg>
                <span class="font-medium">{{ request.LANGUAGE_CODE|default:'de'|upper }}</span>
            </div>

            <div tabindex="0" class="dropdown-content z-[1] menu p-2 shadow bg-base-200  rounded-box w-44">
                <form action="{% url 'set_language' %}" method="post" class="flex flex-col gap-2">
                    {% csrf_token %}
                    <input type="hidden" name="next" value="{{ request.get_full_path }}">
                    <button type="submit" name="language" value="de"
                            class="btn btn-sm justify-start {% if request.LANGUAGE_CODE == 'de' %}btn-primary {% endif %}">
                        ðŸ‡©ðŸ‡ª Deutsch
                    </button>
                    <button type="submit" name="language" value="en"
                            class="btn btn-sm justify-start {% if request.LANGUAGE_CODE|slice:':2' == 'en' %}btn-primary {% endif %}">
                        ðŸ‡¬ðŸ‡§ English
                    </button>
                </form>
            </div>
        </div>{% endcomment %}
        <div class="dropdown dropdown-end w-max lg:hidden">
            <div tabindex="0" role="button" id="menuToggle" class="p-2 swap" aria-expanded="false">
                <c-menu-icon size="size-6" classes="swap-off fill-current"></c-menu-icon>
                <c-menu-icon-open size="size-6" classes="swap-on fill-current"></c-menu-icon-open>
            </div>

            <ul tabindex="0" id="menuDropdown"
                class="mt-10 dropdown-content menu menu-vertical w-max bg-base-200  list-none">
                <li>
                    <c-a url="{% url 'recipe-list' %}">
                        {% translate 'All Recipes' %}
                    </c-a>
                </li>
                {% comment %}<li>
                    <c-a url="{% url 'menu_list' %}">
                        {% translate 'All Menus' %}
                    </c-a>
                </li>{% endcomment %}
                <li>
                    <c-a url="{% url 'wiki:article_list' %}">
                        {% translate 'Wiki' %}
                    </c-a>
                </li>
            </ul>
        </div>
        {% if user.is_authenticated %}
            <div class="hidden lg:flex gap-2 h-full items-center">
                <c-quick-actions></c-quick-actions>
            </div>
            <div class="avatar group/avatar cursor-pointer dropdown dropdown-end dropdown-bottom">
                <div tabindex="0"
                     role="button"
                     class="w-12 h-12 mask mask-hexagon-2 bg-neutral group-hover/avatar:scale-105">
                    {#                    <img src="{{ user.profile.avatar.url }}" alt="Avatar"/>#}
                    <p class="uppercase text-center text-accent-content w-full h-full flex items-center justify-center">
                        {% if user.get_full_name %}
                            {{ user.first_name|slice:":1" }}{{ user.last_name|slice:":1" }}
                        {% else %}
                            {{ user.username|slice:":1" }}
                        {% endif %}
                    </p>
                </div>
                <ul tabindex="0" class="rounded-md dropdown-content menu menu-vertical w-max  bg-base-200 list-none">
                    {% if user.is_authenticated %}
                        <li class="w-full">
                            <c-a url="{% url 'user-profile' user.username %}"
                                 class="flex gap-5 items-center">
                                <c-profile-icon size="size-4"></c-profile-icon>
                                {% translate 'Your Profile' %}
                            </c-a>
                        </li>
                        <li class="w-full">
                            <c-a url="{% url 'account_logout' %}"
                                 class="flex gap-5 items-center">
                                <c-logout-icon size="size-4"></c-logout-icon>
                                {% translate 'Logout' %}
                            </c-a>
                        </li>
                    {% else %}
                        <li class="hover:bg-primary">
                            <c-a animated url="{% url 'account_login' %}">{% translate 'Login' %}</c-a>
                        </li>
                        <li class="hover:bg-primary">
                            <c-a animated url="{% url 'account_signup' %}">{% translate 'Sign up' %}</c-a>
                        </li>
                    {% endif %}
                </ul>
            </div>
        {% else %}
            <c-a url="{% url 'account_login' %}" class="btn btn-md btn-primary">
                {% translate 'Log In' %}
            </c-a>
        {% endif %}
    </div>
</div>

<script>
    const toggle = document.getElementById('menuToggle');

    toggle.addEventListener('focus', () => {
        toggle.classList.add('swap-active');
        toggle.setAttribute('aria-expanded', 'true');
    });

    toggle.addEventListener('blur', () => {
        setTimeout(() => {
            if (document.activeElement !== toggle && !toggle.contains(document.activeElement)) {
                toggle.classList.remove('swap-active');
                toggle.setAttribute('aria-expanded', 'false');
            }
        }, 150);
    });
</script>
